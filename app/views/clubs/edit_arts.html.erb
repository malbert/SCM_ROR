<%
  @add_club_url = new_club_art_url(@club)
%>

<div class="page_header">
  <h1><%=@club.title %>
</div>

<ul class="page-tabs">
  <li class="" id="tab1">
    <%= link_to t('club.basic_info'), edit_club_path %>
  </li>
  <li class="" id="tab2">
    <%= link_to t('club.public_info'), edit_public_club_path %>
  </li>
  <li class="selected" id="tab3">
      <%= link_to t('club.arts'), edit_arts_club_path %>
  </li>
  <li class="" id="tab4">
      <%= link_to t('club.notifications'), 'club#notifications' %>
  </li>
</ul>

 
  

<div class="page-tabs-content">
   <!-- Display list of arts in a table -->
  <div id="arts_selection">
    
      <h2><%= t('club.arts')%> </h2>

      <div class="club_arts_list">
        <div class="title">
            Art martial pratiqu√© dans le club
        </div>
        <ul id="club_arts_list" class="club_arts_list">

          <% @club.arts.find(:all , :conditions => ['enabled = 1']).each do |art| %>
            <li id="art_<%=art.id%>">
              <span class="item_list_content"><%=art.name%></span>
              <span class="item_list_action"><a id="art_action_<%=art.id%>" href="<%=club_art_disable_url(@club.id, art.id)%>"><img src="/images/element_icon_24.png" border="0"></img></a></span>
            </li>
          <% end %>
            <li id="art_add">
              <%= t('club.arts.add')%>
            </li>
        </ul>
        
      </div>
    
     <div class="arrow_drag_drop">
       <img src="/images/arrow_blue_left.png" border="0" height='100px'width='100px' ></img>
     </div>
   
      <div class="club_available_arts_list">

        <div class="title">
          <span>
              <%=t('club.arts.choose')%>
          </span>
          <span class="title_search">
            <input type="search"maxlength="10" size="20" results="1" placeholder="<%=t('search') %>" ></input>
          </span>
        </div>
        
        
          <ul id="club_available_arts_list" class="club_available_arts_list">

          <%@available_arts.each do |art| %>
            <li id="art-available_<%=art.id%>">
              <span class="add_art_icon">
                <a id="a_<%=art.id%>" href="<%=@add_club_url%>"><img src="/images/add_blue.png" width="16px" height="16px"></img> </a></span>
              <span><%=art.name%></span>
            </li>
          <% end %>
        </ul>
      </div>

  </div>   
   
   
</div>

<div style="display : none;">
  <%= link_to 'Show', @club %> |
  <%= link_to t(:back), clubs_path %>
</div>


<script>
  
(function($) {

  var flag = false;
  var disable_url = '<%=club_art_disable_url(@club.id, 1)%>';

    
    $(document).ready(function() { 
      $('ul.club_available_arts_list span.add_art_icon a').live('click', function(e){
              e.preventDefault();

              if (flag == false){
                  flag = true;

                  //1 take the li id

                  var $container = $(this).parents('li');
                  var $container_id = $container.attr('id');

                  var pos = $container_id.indexOf('_');
                  var $template_id = $container_id.substr(pos +1);

                  var $url = $(this).attr('href');

                  //2 ajax call to add the art to the club 
                   $.ajax({
                        method: "get",
                        url: $url,
                        data : {"template_id" : $template_id},
                        complete: function(){ },
                        dataType : "json",
                        success: function(art){ 

                            if (art.id == ""){
                                //TODO handle error
                                console.log('ERROR');
                            } else {
                                $container.fadeOut(500, function(){
                                    //display new art
                                    
                                    var pos_art_id_start = disable_url.indexOf('arts/') + 5;
                                    var disable_url_spec =  disable_url.substring(0, pos_art_id_start) + art.id + '/disable';
                                    console.log(disable_url_spec);
                                    
                                    var html = '<li class="hiden appearing" id="art_' + art.id + '"><span class="item_list_content">' + art.name + '</span>' ;
                                    html += '<span class="item_list_action"><a id="art_action_'+ art.id +'" href=" ' + disable_url_spec + '"><img src="/images/element_icon_24.png" border="0"></img></a></span>';
                                    $(html).insertBefore('ul.club_arts_list li:last-child');
                                    
                                    $('ul.club_arts_list li#art_'+art.id).fadeIn(1000,function(){
                                        $(this).css('font-weight', 'normal');
                                    });
                                })
                            }


                            flag = false;

                        }
                    }); //close $.ajax()
              }
          });
          
          $('a').live('click', function(){console.log(this)});

          $('a[id^="art_delete_action_"]').live('click', function(e){
              e.preventDefault();
              console.log('test');

              if (flag == false){
                  flag = true;

                  var $container = $(this).parents('li');
                  var $url = $(this).attr('href');

                  var pos = $(this).attr('id').indexOf('_');
                  var $art_id = $(this).attr('id').substr(pos +1);

                  //2 ajax call to add the art to the club 
                   $.ajax({
                        method: "get",
                        url: $url,
                        data : {"jquery_id" : $art_id},
                        dataType : "json",
                        complete: function(){ },
                        success: function(art){ 

                            if (art.enabled == 1){
                                //todo handle error
                                console.log('ERROR');
                            } else {
                                $container.fadeOut(500);
                            }
                            flag = false;

                        }
                    }); //close $.ajax()
              }
          });

          $('a[id^="art_action"]').live('click', function(e){
              //this action will display the delete button
              e.preventDefault();
              var $url = $(this).attr('href');

              var pos = $(this).attr('id').indexOf('_');
              var $art_id = $(this).attr('id').substr(pos +1);

              //build the new element
              var label = "Delete";
              var html = '<a class="hidden delete" href="' + $url + '" id="art_delete_' + $art_id +'">' + label + '</a>';
              console.log(html);
              $(html).insertAfter($(this));

              $(this).fadeOut(300, function(){
                $('#art_delete_' + $art_id).fadeIn(300);
              });

          });

        });
  
})(jQuery);

  
</script>